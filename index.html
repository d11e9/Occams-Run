<html>
    <head>
        <title>Occams Run</title>
        <style>

            body {
                background-color: black;
                background-image: url('run.gif');
                background-repeat: no-repeat;
                background-size: contain;
                background-position: center bottom;
            }
            html, body {
                font-family: monospace;
                margin: 0;
                padding: 0;
                background-color: black;
            }

            #wrapper {
                padding: 0 5em;
                color: white;
                height: 100%;
                background-color: rgba( 0,0,0,0.8);
                padding-bottom: 14em;
            }
            .header {
                text-align: center;
                margin: 0 auto;
                max-width:  40em;
                margin-bottom: 5em;
            }

            .header h1 {
                margin: 0;
                padding: 0;
            }
            .header h1 img { width: 100%; }
            .header p {
                font-size: 2em;
                font-weight: bold;
            }
            .int, .info {
                text-align: left;
                margin: 0 auto;
                margin-bottom: 5em;
                padding: 0 1em;
                max-width:  40em;
                overflow: auto;
            }

            .amount {
                background-color: rgba( 255,255,255,0.2);
                padding: 0.4em;
                border: 0 none;
                color: white;
                margin-left: 1em;
            }

            button {
                background-color: #f41e23;
                padding: 0.4em;
                border: 0 none;
                color: white;
                font-weight: bold;
                border-radius: 0.4em;
                cursor: pointer;
            }

            .left { float: left; }
            .right { float: right; }

            .players span { margin-right: 2em; }
        </style>
        <script src="jquery.min.js"></script>
    </head>
    <body>
        
        <div id="wrapper">
            <div class="header">
                <h1>
                    <img src="logo-0.0.2.png" alt="Occam's Run">
                </h1>
                <p>All things being equal (50/50) only the brave will win.</p>
            </div>

            <div class="info">
                <p class="left">Occam's Run balance: <span class="occamsBalance">0</span> ETH</p>
                <p class="right">Players: <span class="playerCount">0</span></p>
            </div>

            <div class="int interface0">
                <p>You have <span class="balance">0</span> ETH at stake.</p>
                <p class="left"><button class="send" title="Theres a 50/50 chance you will increase your stake or lose everything.">Send</button><input class="amount" type="text" value="0" /> ETH </p>
                <p class="right"> <button class="withdraw" title="Withdraw all ETH you have at stake.">Withdraw</button></p>
            </div>

            <div class="debug">
                
            </div>
            
        </div>

        <script src="poly-eth/poly-eth.bundle.js"></script>
        <script>

                var polyeth = polyeth( typeof eth === 'undefined' ? undefined : eth );
                var OCCAMSRUN_ADDRESS = '0x977bed08637eb96968a5f28a93eb5ea9c2692d5d';

                function debug() {

                    for (var x=0; x<arguments.length; x++) {
                        $('.debug').append( $( '<p>'+arguments[x]+'</p>' ) )  
                    }
                }

                window.onerror = function(err){
                    debug("error:", err)
                }

                polyeth.ready( function(){

                    debug( 'ready...' )

                    var SELF_ADDRESS = polyeth.secretToAddress( polyeth.key );

                    debug( SELF_ADDRESS, typeof SELF_ADDRESS )

                    // polyeth.eth.watch( OCCAMSRUN_ADDRESS, updateInfo )

                    polyeth.watch( OCCAMSRUN_ADDRESS, updateInfo );
                    

                    $('.send').click( send )
                    $('.withdraw').click( withdraw )

                    function updateInfo() {
                        $('.occamsBalance').html( polyeth.balanceAt( OCCAMSRUN_ADDRESS ) )
                        $('.playerCount').html( polyeth.storageAt( OCCAMSRUN_ADDRESS, '0x17' ) )
                        $('.balance').html( polyeth.storageAt( OCCAMSRUN_ADDRESS, SELF_ADDRESS ) )
                        debug( 'updated info')
                    }

                    function send() {
                        var value = parseInt( $('.amount').val() );
                        polyeth.sendTX( occam, value, [], function(){ } )
                    }

                    function withdraw(){
                        debug( 'withdrawing', polyeth.storageAt( OCCAMSRUN_ADDRESS, SELF_ADDRESS ) )
                        polyeth.transact( polyeth.key, '0x0', OCCAMSRUN_ADDRESS, [ '0x1'.bin() ], '0x10', '0x100', function(){debug('withdrawn')}) 
                    }


                })

        </script>


    </body>
</html>